<!doctype html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width', initial-scale='1.0'>
        <title>phosphorus</title>
        <link rel='stylesheet' href='https://sulfurous.aau.at/versions/v0.86/css/player.css'>
        <link rel='stylesheet' href='https://sulfurous.aau.at/css/embed.css'>
        <style>
            html {
                overflow: hidden;
                background-color: #fff;
            }
            body {
                margin: 0 0 0 auto;
            }
        </style>
    </head>
    <body>
        <input type="file" name="myfile" id="loader" style="display: none;" accept=".sb2" />
        <div class='controls'>
            <div class='progress-bar'></div>
            <span class='stop'></span>
            <span class='pause'></span>
            <span class='flag' title="Shift+click to enable turbo mode."></span>
            <div class='turbo'>Turbo Mode</div>
            <span class='full-screen'></span>
        </div>
        <div class='player'></div>
        <div class='internal-error'>
            An internal error occurred. <a id='error-bug-link' target='_blank 'href='https://github.com/nathan/phosphorus/issues/new'>Click here</a> to file a bug report.
        </div>
        <script src="https://sulfurous.aau.at/js/fonts.js"></script>
        <script src='//cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js'></script>
        <script src='phosphorus.min.js'></script>
        <script src='player.min.js'></script>
        <script src="https://sulfurous.aau.at/js/fonts.js"></script>
        <script>
            (function() {
                'use strict';
                let project = "";

                var autoStart = false;
                var lightContent = false;
                var hasUI = true;
                var resolutionX = Math.floor((window.innerHeight - 32) * (4/3));
                var resolutionY = Math.floor(window.innerHeight - 32);
                //499x413 503.09701492473005x417

                P.resolution = resolutionX;
                P.player.setResolution(resolutionX, resolutionY);
                document.body.style.width = resolutionX + 'px';

                if (lightContent) document.body.className += ' light-content';
                document.body.className += hasUI ? ' has-ui' : ' hide-ui';
                document.title = 'phosphorus';

                //this saddly doesn't work unless on a server
                /*let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = () => {
                    if (xhttp.status == 200 && xhttp.readyState == 4) {
                        load(xhttp.response);
                    }
                };
                xhttp.open("GET", "project.sb2", true);
                xhttp.responseType = "blob";
                xhttp.send(null);*/


                function load (sb2) {
                    console.log(sb2);
                    //const request = P.IO.loadSB2Project(zip)


                    /*var request = P.IO.loadSB2File(sb2);
                    if (request) {
                        P.player.showProgress(request, function(stage) {
                            if (autoStart || !hasUI) stage.triggerGreenFlag();
                        });
                    }*/
                }
                document.addEventListener("DOMContentLoaded", () => {
                    /*document.getElementById("loader").addEventListener("load", () => {
                        load(document.getElementById("upload").files[0]);
                    });
                    console.log("document loaded");
                    let timer = setInterval(() => {
                        console.log(document.readyState);
                        if (document.readyState == "complete") {
                            clearInterval(timer);
                            document.getElementById("loader").click();
                            }
                    }, 1000);*/
                    let div = document.createElement("div");
                    div.setAttribute("style", "position: absolute; left: calc(50% - 50px); top: calc(50% - 25px); width: 100px; height: 50px; user-select: none; background-color: gray; line-height: 50px; text-align: center; cursor: pointer;");
                    div.appendChild(document.createTextNode("Load SB2"));
                    div.addEventListener("click", () => {
                        document.getElementById("loader").click();
                        div.parentElement.removeChild(div);
                    });
                    document.body.appendChild(div);
                    document.getElementById("loader").addEventListener("change", (e) => {
                        //load(document.getElementById("loader").files[0]);
                        var f = document.getElementById("loader").files[0];



                        if (f) {
                            var ext = f.name.split('.').pop();
                            if (ext === 'sb2' || ext === 'zip') {
                                var request = P.IO.loadSB2File(f);
                            } else if (ext === 'json') {
                                request = P.IO.loadJSONFile(f);
                            }
                            if (request) {
                                P.player.showProgress(request, function(stage) {
                                    stage.triggerGreenFlag();
                                });
                            }
                        }
                    });
                });



            }());

            //resizing has issues with cutting off parts of the screen
            window.onresize = () => {
                let width = Math.floor((window.innerHeight - 32) * (4/3));
                P.resolution = width;
                P.player.setResolution(width, Math.floor(window.innerHeight - 32));
                document.body.style.width = width + 'px';
            };
        </script>
    </body>
</html>
